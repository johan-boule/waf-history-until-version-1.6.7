#!/usr/bin/env python
# encoding: utf-8
# Yinon Ehrlich, 2009

"""
Prints Waf's internal representation of filesystem (nodes).
Handy for debugging Node zone problems -
For each node prints:
	its parent id, its own id, the signature dictionary where it appears.

Actually in this empty project this it's useless,
however found to be useful for locating errors in handling generated files.
"""

def configure(conf):
	pass

def build(bld):
	print_dynasty(bld.srcnode)

def print_dynasty(node):
	_dynasty = ''
	bld = node.__class__.bld
	# print the node and its childs, recursively
	if not node: return ''
	if not getattr(node, 'childs', False): return ''
	indent = node.height() * '   '
	for child in node.childs.itervalues():
		variant = child.variant(bld.env)
		signature_type = '-'
		if child.id in bld.node_sigs[variant]:
			if variant: signature_type = 'bld_sig'
			else: signature_type = 'src_sig'
		_dynasty += '%s %s (%d-->%d)\t[%s]\n' % (indent, child.name, node.id, child.id, signature_type)
		_dynasty += print_dynasty(child)
	
	print _dynasty
