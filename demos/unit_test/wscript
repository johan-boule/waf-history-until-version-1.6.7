#! /usr/bin/env python
# encoding: utf-8
# Richard Quirk, 2008

import UnitTest

srcdir = '.'
blddir = 'build'

def set_options(opt):
	opt.tool_options('compiler_cxx')

def configure(conf):
	conf.check_tool('compiler_cxx')

	# this one requires cppunit
	pkgconfig = conf.create_pkgconfig_configurator()
	pkgconfig.name = 'cppunit'
	pkgconfig.run()

def build(bld):
	# process subfolders from here
	subdirs = 'src'
	# if cppunit was found in the config step, build unit tests too
	if bld.env()['HAVE_CPPUNIT']:
		subdirs += ' tests'
	bld.add_subdirs(subdirs)

def shutdown():
	ut = UnitTest.unit_test()
	ut.change_to_testfile_dir = True
	# normally only seen if we run "waf check"
	ut.run_if_waf_does = 'build'
	ut.run()
	ut.print_results()
