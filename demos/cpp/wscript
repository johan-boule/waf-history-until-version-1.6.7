#! /usr/bin/env python
# encoding: utf-8
# Thomas Nagy, 2006 (ita)

# look for 'meow' below
#import Params

# the following two variables are used by the target "waf dist"
VERSION='0.0.1'
APPNAME='cpp_test'

# these variables are mandatory ('/' are converted automatically)
srcdir = '.'
blddir = '_build_'

def init():
	pass
	# disable the Waf preprocessor for finding dependencies
	#import Params
	#Params.g_preprocess=0

	# redefine the cpp source extensions
	#import cpp
	#cpp.cppobj.s_default_ext = ['.cxx', '.cxy', '.cxyz']

def set_options(opt):
	# options provided in a script in a subdirectory named "src"
	opt.sub_options('src')

	# options provided by the modules
	opt.tool_options('g++')

	# custom options
	opt.add_option('--exe', action='store_true', default=False, help='exe')

def configure(conf):
	# conf.env['CXX'] = Params.g_options.meow
	# CXX=g++-3.0 ./waf.py configure will use g++-3.0 instead of 'g++'
	conf.check_tool('g++')

	## batched builds can be enabled by including the module optim_cc
	# conf.check_tool('batched_cc')

	conf.sub_config('src')

	conf.env['CXXFLAGS_MYPROG']='-O3'
	conf.env['LIB_MYPROG']='m'
	conf.env['SOME_INSTALL_DIR']='/tmp/ahoy/lib/'

	# works in a procedural way, so the order of calls does matter
	#conf.check_tool(['KDE3'])

def build(bld):
	# process subfolders from here
	bld.add_subdirs('src src2')

def shutdown():
	# command to execute
	cmd = "PATH=plugins:$PATH LD_LIBRARY_PATH=_build_/default/src/:$LD_LIBRARY_PATH _build_/default/src/testprogram"

	# if the custom option is set, execute the program
	import os, Params
	if Params.g_options.exe:
		os.popen(cmd)

	# in case if more people ask
	#if Params.g_commands['install']:
	#	try: os.popen("/sbin/ldconfig")
	#	except: pass

