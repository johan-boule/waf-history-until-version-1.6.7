#! /usr/bin/env python
# encoding: utf-8
# Thomas Nagy, 2006 (ita)

# the following two variables are used by the target "waf dist"
VERSION='0.0.1'
APPNAME='wafdocs'

# these variables are mandatory ('/' are converted automatically)
srcdir = '.'
blddir = 'build'

def set_options(opt):
	opt.add_option('--exe', action='store_true', default=False, help='Execute the program after it is compiled')

def configure(conf):
	conf.check_tool('docbook', tooldir='.')
	conf.check_tool('misc')
	conf.env['XSLTPROC_ST'] = '%s --output default/ --stringparam callout.graphics.path "" --stringparam admon.graphics 1  --stringparam html.stylesheet waf.css --xinclude %s %s > %s'

def build(bld):
	obj = bld.new_task_gen('docbook')
	obj.source = 'waf.xml'

	obj.type = 'html'
	#obj.stylesheet='/usr/share/xml/docbook/stylesheet/nwalsh/current/xhtml/docbook.xsl'
	obj.stylesheet='/usr/share/xml/docbook/stylesheet/nwalsh/current/html/chunk.xsl'

	#obj.type = 'pdf'
	#obj.stylesheet = "/usr/share/xml/docbook/stylesheet/nwalsh/current/fo/docbook.xsl"
	import os
	for k in ['pics', 'callouts']:
		files = os.listdir(k)
		for x in files:
			if x == '.svn':
				continue
			foo = bld.new_task_gen('copy')
			foo.source = k+'/'+x
			foo.target = x

def shutdown():
	import os
	import Options
	if Options.options.exe:
		os.popen('konqueror $PWD/build/default/index.html')
